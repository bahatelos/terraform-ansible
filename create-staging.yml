---
- hosts: localhost
  connection: local
  gather_facts: false
  
  tasks: 
    - name: copy .ansible.cfg file at user's home dir
      copy: 
        src: files/.ansible.cfg
        dest: ~/

    - name: copy ssh.cfg file 
      copy:
        src: files/news-app-ssh.cfg
        dest: /tmp/

    - name: init terraform
      shell: terraform init
      args:
        chdir: terraform/
      environment:
        aws_secret_access_key: "{{ lookup('cypher','secret=tfvars/TerraformAnsible')|to_json|json_query('aws_secret_access_key') }}"
        aws_access_key_id: "{{ lookup('cypher','secret=tfvars/TerraformAnsible')|to_json|json_query('aws_access_key_id') }}"
      vars:
          private_key_name: a_wrong_value
          private_key_file_path: a_wrong_value
          ssh_location: 0.0.0.0/0
    # - name: apply terraform script
    #   terraform:
    #     project_path: terraform/
    #     state: present
